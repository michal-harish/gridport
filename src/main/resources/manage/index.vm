#include("manage/header.vm")

<script>
    var contracts = [];
    $.ajax({url: '/manage/contracts.json',dataType: 'json',type: 'GET'})
        .done(function(data) { contracts = data;})
        .fail(function(data) { $('.error').text($.parseJSON(data.responseText).message);});
</script>

<header>
<em>GridPort Server Instance</em> | $request.getRemoteHost() | $this.getCurrentUser()  
| <a href="$this.getLogsUrl()">logs</a> 
| <form style="display:inline;" method="POST" action="$this.getRestartUrl()" onsubmit='return confirm("Reload configuration and restart the server ?");'><input type="submit" name="restart" value="RESTART"/></form>
</header>

#if ($msg != "")
<a class="error">$msg</a> 
#end

<table cellpadding="10">
<tr>
<td>
    <section>
    <h2>Contracts & SLAs</h2>
    <table>
        <thead>
            <tr>
                <th>Contract</th>
                <th>IP-Ranges</th>
                <th>Auth-Groups</th>
                <th>Rate-Limit</th>
                <th>Time-Ranges</th>
                <th><form style="display:inline;" method="POST" action="$this.getContractsUrl()" onsubmit='this.name.value=prompt("New contract name:"); return this.name.value ? true : false;'><input type="hidden" name="name"/><input type="submit" value="ADD"/></form></th>
            </tr>
        </thead>
        <tbody>
        #foreach( $contract in $contracts )
            <tr>
            <td><a href="$this.getContractUrl($contract)">$contract.getName()</a></td>
            <td>$contract.getIpFilters()</td>
            <td>$contract.getGroups()</td>
            <td>#if ($contract.getIntervalMs()>0) $contract.getFrequency()/$contract.getIntervalMs()ms #end</td>
            </tr>
        #end
        </tbody>
    </table>
    </section>
</td>
<td>
    <section>
    <h2>Users & Groups</h2>
    <table>
        <thead>
            <tr>
                <th>Username</th>
                <th>Groups</th>
                <th><form style="display:inline;" method="POST" action="$this.getUsersUrl()" onsubmit='this.username.value=prompt("New username:"); return this.username.value ? true : false;'><input type="hidden" name="username"/><input type="submit" name="newuser" value="ADD"/></form></th>
            </tr>
        </thead>
        <tbody>
        #foreach( $user in $users )
            <tr><td><a href="$this.getUsersUrl()/$user.getUsername()">$user.getUsername()</a></td><td>$user.getGroups()</td></tr>
        #end
        </tbody>
    </table>
    </section>
</td>
</table>

    <section>
        <h2>Routing Table (Endpoints)</h2>
        <table>
            <thead>
                <th>Protocol://Host/URI-Pattern</th>
                <th>Gateway</id>
                <th>Allowed Methods</id>
                <th>Async </th>
                <th>Endpoint-URI-Base</th>
                <th>ID</id>
            </thead>
            <tbody>
            #foreach( $endpoint in $endpoints.values() )
                <tr>
                    <td>
                        <a href="$this.getEndpointUrl($endpoint.getId())">
                            $endpoint.getUrlPattern($request.getServerName())
                        </a>
                    </td>
                    <td>#if ($endpoint.getGateway()) $endpoint.getGateway()#end</td>
                    <td>#if ($endpoint.getHttpMethod()) $endpoint.getHttpMethod()#end</td>
                    <td>#if ($endpoint.getAsync()) $endpoint.getAsync() #end</td>
                    <td>$endpoint.getEndpoint()</td>
                    <td><a href="$this.getEndpointUrl($endpoint.getId())">$endpoint.getId()</a></td>
                </tr>
            #end
            </tbody>
        </table>
    </section>

<div>
    <h2>Active Client Threads</h2>
    <ul>
        #foreach( $processInfo in $processes )
            <li>$processInfo</li>
        #end
    </ul> 
</div>


#include("manage/footer.vm")
